{"ast":null,"code":"import _toConsumableArray from\"/Users/user/Downloads/petlove-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/user/Downloads/petlove-main/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/user/Downloads/petlove-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/Users/user/Downloads/petlove-main/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/user/Downloads/petlove-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createContext,useEffect,useState}from\"react\";import{getDoc}from\"firebase/firestore\";import{addPet,getAll,updatePet}from\"../services/petService\";import{jsx as _jsx}from\"react/jsx-runtime\";export var PetContext=/*#__PURE__*/createContext({pets:[],addNewPet:function addNewPet(pet){},updateCurrentPet:function updateCurrentPet(pet){},removePet:function removePet(petId){},likePet:function likePet(pet,userId){},unLikePet:function unLikePet(pet,userId){}});export var PetContextProvider=function PetContextProvider(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),pets=_useState2[0],setPets=_useState2[1];useEffect(function(){getAll().then(function(pets){var currentPets=[];pets.forEach(function(p){var pet=_objectSpread({id:p.id},p.data());currentPets.push(pet);});setPets(currentPets);}).catch(function(error){console.log(error);});},[]);var addNewPet=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(pet){var refPet,docSnap;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return addPet(pet);case 2:refPet=_context.sent;_context.next=5;return getDoc(refPet);case 5:docSnap=_context.sent;setPets(function(prevState){return prevState.concat({id:docSnap.id,name:docSnap.data().name,bread:docSnap.data().bread,imageUrl:docSnap.data().imageUrl,description:docSnap.data().description,ownerId:docSnap.data().ownerId,likedBy:docSnap.data().likedBy});});case 7:case\"end\":return _context.stop();}}},_callee);}));return function addNewPet(_x){return _ref.apply(this,arguments);};}();var likePet=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(pet,userId){var likedBy,updatedLikePet;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// const index = pets.findIndex((p) => p.id === pet.id)\n// const newRef = [...pets];\nlikedBy=pet.likedBy||[];updatedLikePet=_objectSpread(_objectSpread({},pet),{},{likedBy:[].concat(_toConsumableArray(likedBy),[userId])});_context2.next=4;return updateCurrentPet(updatedLikePet);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function likePet(_x2,_x3){return _ref2.apply(this,arguments);};}();var unLikePet=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(pet,userId){var likedIndex,likedBy,updatedPet;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:likedIndex=pet.likedBy.findIndex(function(id){return id===userId;});likedBy=_toConsumableArray(pet.likedBy);likedBy=[].concat(_toConsumableArray(likedBy.slice(0,likedIndex)),_toConsumableArray(likedBy.slice(likedIndex+1)));updatedPet=_objectSpread(_objectSpread({},pet),{},{likedBy:likedBy});_context3.next=6;return updateCurrentPet(updatedPet);case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function unLikePet(_x4,_x5){return _ref3.apply(this,arguments);};}();var updateCurrentPet=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(pet){var result,index,updatedPets;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return updatePet(pet);case 2:result=_context4.sent;index=pets.findIndex(function(p){return p.id===result.id;});updatedPets=_toConsumableArray(pets);updatedPets[index]=_objectSpread(_objectSpread({},result),{},{id:pet.id});setPets(updatedPets);case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function updateCurrentPet(_x6){return _ref4.apply(this,arguments);};}();var removePet=function removePet(petId){setPets(function(prevState){return prevState.filter(function(pet){return pet.id!==petId;});});};return/*#__PURE__*/_jsx(PetContext.Provider,{value:{pets:pets,addNewPet:addNewPet,updateCurrentPet:updateCurrentPet,removePet:removePet,likePet:likePet,unLikePet:unLikePet},children:props.children});};","map":{"version":3,"names":["createContext","useEffect","useState","getDoc","addPet","getAll","updatePet","PetContext","pets","addNewPet","pet","updateCurrentPet","removePet","petId","likePet","userId","unLikePet","PetContextProvider","props","setPets","then","currentPets","forEach","p","id","data","push","catch","error","console","log","refPet","docSnap","prevState","concat","name","bread","imageUrl","description","ownerId","likedBy","updatedLikePet","likedIndex","findIndex","slice","updatedPet","result","index","updatedPets","filter","children"],"sources":["/Users/user/Downloads/petlove-main/src/context/PetContext.js"],"sourcesContent":["import { createContext, useEffect, useState } from \"react\";\n\nimport { getDoc } from \"firebase/firestore\";\n\nimport { addPet, getAll, updatePet } from \"../services/petService\";\n\n\nexport const PetContext = createContext({\n    pets: [],\n    addNewPet: (pet) => { },\n    updateCurrentPet: (pet) => { },\n    removePet: (petId) => { },\n    likePet: (pet, userId) => { },\n    unLikePet: (pet, userId) => { },\n})\n\nexport const PetContextProvider = (props) => {\n    const [pets, setPets] = useState([]);\n\n\n    useEffect(() => {\n        getAll().then((pets) => {\n            const currentPets = [];\n\n            pets.forEach((p) => {\n                const pet = {\n                    id: p.id,\n                    ...p.data()\n                }\n                currentPets.push(pet)\n            });\n            setPets(currentPets);\n        }).catch((error) => {\n            console.log(error)\n        })\n    }, [])\n\n\n    const addNewPet = async (pet) => {\n\n        const refPet = await addPet(pet);\n        const docSnap = await getDoc(refPet);\n\n        setPets((prevState) =>\n            prevState.concat({\n\n                id: docSnap.id,\n                name: docSnap.data().name,\n                bread: docSnap.data().bread,\n                imageUrl: docSnap.data().imageUrl,\n                description: docSnap.data().description,\n                ownerId: docSnap.data().ownerId,\n                likedBy: docSnap.data().likedBy,\n            })\n        );\n    };\n\n    const likePet = async (pet, userId) => {\n\n        // const index = pets.findIndex((p) => p.id === pet.id)\n        // const newRef = [...pets];\n\n        let likedBy = pet.likedBy || [];\n        const updatedLikePet = { ...pet, likedBy: [...likedBy, userId] }\n\n        await updateCurrentPet(updatedLikePet);\n\n    }\n\n    const unLikePet = async (pet, userId) => {\n\n        const likedIndex = pet.likedBy.findIndex((id) => id === userId);\n\n        let likedBy = [...pet.likedBy];\n\n        likedBy = [\n            ...likedBy.slice(0, likedIndex),\n            ...likedBy.slice(likedIndex + 1),\n        ];\n\n        const updatedPet = { ...pet, likedBy: likedBy };\n\n        await updateCurrentPet(updatedPet);\n    }\n\n    const updateCurrentPet = async (pet) => {\n\n        const result = await updatePet(pet)\n        const index = pets.findIndex((p) => p.id === result.id)\n\n        const updatedPets = [...pets]\n        updatedPets[index] = { ...result, id: pet.id }\n\n\n        setPets(updatedPets)\n    }\n\n    const removePet = (petId) => {\n        setPets((prevState) => prevState.filter((pet) => pet.id !== petId));\n    };\n\n    return (\n        <PetContext.Provider\n            value={{\n                pets,\n                addNewPet,\n                updateCurrentPet,\n                removePet,\n                likePet,\n                unLikePet,\n            }}>\n            {props.children}\n        </PetContext.Provider>\n    );\n} "],"mappings":"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"},"metadata":{},"sourceType":"module"}